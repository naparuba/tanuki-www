<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Online course 1: installing shinken 2.0 / Some monitoring guys</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="shortcut icon" href="/theme/favicon.ico" />
        <link rel="apple-touch-icon" href="/theme/apple-touch-icon-iphone.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/theme/apple-touch-icon-ipad.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/theme/apple-touch-icon-iphone4.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="/theme/apple-touch-icon-ipad3.png" />

        <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
        <link rel="stylesheet" href="/theme/css/bootstrap-responsive.min.css">
        <link rel="stylesheet" href="/theme/css/colorbox.css">

        <link rel="stylesheet" href="/theme/css/main.css">

        <script src="/theme/js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div class="container-fluid">
            <div class="row-fluid">

	      <a class='span4' href='/'> Home</a>
	      <a class='span1' href='/intro/index.html'>Intro</a>
	      <a class='span1' href='/docs/index.html'>Docs</a>
	      <a class='span1' href='/community.html'>Community</a>
	      <a class='span1' href='/demo.html'>Demo</a>
	      <a class='span2' href='/download.html'>Download</a>
	      <a class='span2' href='github'>Github</a>
	    </div>
            <div class="row-fluid">
                <div class="span4" id='content'>
		  

                </div> <!-- logo+navigation span -->


                <div class="span8">
                    <header id="site-header">
                        <h1>
                            <a href="">Some monitoring guys</a>
                            <small>
                                <span class="divider">/</span> 
                            </small>
                        </h1>
                        <!--<p>
                            
                        </p>-->
                    </header>

                    <div class="content">
<section>
    <article>
        <header>
            <h2><a href="/online-course-1-installation/" rel="bookmark">Online course 1: installing shinken 2.0</a></h2>
            <time datetime="2014-03-04T10:20:00">Mar 04, 2014</time>
	    <span class='author'>, Gabès Jean</span>

        </header>

    <p>Hi,</p>
<p>This is our first online course, and we are starting for the very start: how to install shinken :D</p>
<p>We want to have a running shinken installation on a simple linux box. We will take a debian 7 but also provide information for centos6.</p>
<p>You can follow this tutorial with this video:</p>
<iframe width="800" height="600" src="//www.youtube.com/embed/jtUytVXtw14" frameborder="0" allowfullscreen></iframe>

<p>(You can also have a <a href="http://www.youtube.com/watch?v=3LxKCoX6D6s">FR version of the video</a>)</p>
<p>Your shinken daemons will need a user/group to run. Its name is quite obvious, it's just <code>shinken</code>, and as a simple user.</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">adduser</span> <span class="n">shinken</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">id</span> <span class="n">shinken</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">shinken</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">shinken</span><span class="p">)</span>
</pre></div>


<p>Now your user/group is ok, you need to install some dependencies for shinken installation :</p>
<ul>
<li><code>python-pycurl</code> : (great and powerfull) lib for http connexions between the shinken daemons</li>
<li><code>python-setuptools</code> and <code>python-pip</code>: installation tool for python lib</li>
</ul>
<p>Just launch:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pycurl</span> <span class="n">python</span><span class="o">-</span><span class="n">setuptools</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span>
</pre></div>


<p>And for Centos6:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">centos</span><span class="err">#</span> <span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//mirror-fpt-telecom.fpt.net/fedora/epel/6/i386/epel-release-6-8.noarch.rpm &amp;&amp; rpm -Uvh epel*rpm</span>
<span class="n">root</span><span class="err">@</span><span class="n">centos</span><span class="err">#</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">pycurl</span> <span class="n">python</span><span class="o">-</span><span class="n">setuptools</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span>
<span class="n">root</span><span class="err">@</span><span class="n">centos</span><span class="err">#</span> <span class="n">echo</span> <span class="err">&#39;</span><span class="n">alias</span> <span class="n">pip</span><span class="o">=</span><span class="s">&quot;/usr/bin/pip-python&quot;</span><span class="err">&#39;</span> <span class="o">&gt;&gt;</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">bashrc</span>
<span class="n">root</span><span class="err">@</span><span class="n">centos</span><span class="err">#</span> <span class="p">.</span> <span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">bashrc</span>
</pre></div>


<p>As our dependencies are ok, we can now get and install our shinken daemons:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">shinken</span>
<span class="p">[...]</span>
<span class="n">Shinken</span> <span class="n">setup</span> <span class="n">done</span>
</pre></div>


<p>Let's have a look at the paths that are used by shinken:</p>
<ul>
<li><code>/etc/shinken</code>: all your configuration will be there</li>
<li><code>/usr/bin/shinken-*</code>: the shinken daemons scripts</li>
<li><code>/var/lib/shinken</code>: where you will find the shinken modules or your check plugins</li>
<li><code>/var/log/shinken</code>: the logs (what did you expect? :) )</li>
</ul>
<p>In order to start your new daemons, you just need to use the init.d script:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">shinken</span> <span class="n">start</span>
</pre></div>


<p>Your can look at your daemons by checking your shinken user, and even query a daemon:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">ps</span> <span class="o">-</span><span class="n">fu</span> <span class="n">shinken</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">curl</span> <span class="n">http</span><span class="o">:</span><span class="c1">//localhost:7770/</span>
<span class="n">OK</span>
</pre></div>


<p>We can look at the only host that is checkd by default: the localhost :) Like all hosts, it's configuration is in a file in <code>/etc/shinken/hosts/</code>:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">hosts</span><span class="o">/</span><span class="n">localhost</span><span class="p">.</span><span class="n">cfg</span>
</pre></div>


<p>By default this host is a dummy one, with no real checks (<code>generic-host</code> is a default <code>template</code> that give default values for an host). We want some basic linux monitoring (disks, load, memory, I/O and stuff like that). That what monitoring <code>packs</code> are done for. </p>
<p>Lof of them are available on the <a href="http://shinken.io">shinken.io</a> website. Let's look what is available for our linux host, by using the <code>shinken</code> command that allow to query the <code>shinken.io</code> site. </p>
<p>From now we will switch to the user shinken so the packages installations will be done by this user, and so there won't be problem for it to use them :)</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">su</span> <span class="o">-</span> <span class="n">shinken</span>
</pre></div>


<p>The shinken cli command need to be initialized, in order to generate the <code>~/.shinken.ini</code> file with all the paths to the shinken directories:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">shinken</span> <span class="o">--</span><span class="n">init</span>
</pre></div>


<p>Then you can start to search for linux pack:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">shinken</span> <span class="n">search</span> <span class="n">linux</span>
<span class="n">glances</span> <span class="p">(</span><span class="n">david</span><span class="o">-</span><span class="n">guenault</span><span class="p">)</span> <span class="p">[</span><span class="n">pack</span><span class="p">,</span><span class="n">system</span><span class="p">,</span><span class="n">linux</span><span class="p">,</span><span class="n">glances</span><span class="p">]</span> <span class="o">:</span> <span class="n">Standard</span> <span class="n">check</span> <span class="n">through</span> <span class="n">checkglances</span><span class="p">.</span><span class="n">py</span> <span class="n">and</span> <span class="n">glances</span> <span class="n">server</span>
<span class="n">linux</span><span class="o">-</span><span class="n">snmp</span> <span class="p">(</span><span class="n">naparuba</span><span class="p">)</span> <span class="p">[</span><span class="n">pack</span><span class="p">,</span><span class="n">linux</span><span class="p">,</span><span class="n">snmp</span><span class="p">]</span> <span class="o">:</span> <span class="n">Linux</span> <span class="n">checks</span> <span class="n">based</span> <span class="n">on</span> <span class="n">SNMP</span>
<span class="n">linux</span><span class="o">-</span><span class="n">ssh</span> <span class="p">(</span><span class="n">dessaiimrane</span><span class="p">)</span> <span class="p">[</span><span class="n">pack</span><span class="p">,</span><span class="n">linux</span><span class="p">,</span><span class="n">ssh</span><span class="p">]</span> <span class="o">:</span> <span class="n">Linux</span> <span class="n">checks</span> <span class="n">based</span> <span class="n">on</span> <span class="n">SSH</span> <span class="n">without</span> <span class="n">any</span> <span class="n">script</span> <span class="n">on</span> <span class="n">distant</span> <span class="n">server</span>
<span class="n">pack</span><span class="o">-</span><span class="n">glances</span> <span class="p">(</span><span class="n">david</span><span class="o">-</span><span class="n">guenault</span><span class="p">)</span> <span class="p">[</span><span class="n">pack</span><span class="p">,</span><span class="n">system</span><span class="p">,</span><span class="n">linux</span><span class="p">,</span><span class="n">glances</span><span class="p">]</span> <span class="o">:</span> <span class="n">Standard</span> <span class="n">check</span> <span class="n">through</span> <span class="n">checkglances</span><span class="p">.</span><span class="n">py</span> <span class="n">and</span> <span class="n">glances</span> <span class="n">server</span>
</pre></div>


<p>We got some options for monitor our linux. I'm a big fan of agentless monitoring, so I'm choosing the <code>linux-ssh</code> one that allow us to check a linux with just a ssh key on it. We just need to install it:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">shinken</span> <span class="n">install</span> <span class="n">linux</span><span class="o">-</span><span class="n">ssh</span>
</pre></div>


<p>This package came with included plugins and put them into <code>/var/lib/shinken/libexec</code>, but currently not all are like this.</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">libexec</span><span class="o">/*</span><span class="n">py</span>
<span class="n">check_net_stats_by_ssh</span><span class="p">.</span><span class="n">py</span>
<span class="n">check_nfs_stats_by_ssh</span><span class="p">.</span><span class="n">py</span>
<span class="p">[...]</span>
</pre></div>


<p>Theses plugins need the <code>python-paramiko</code> lib for the ssh connexion, so we must install it:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">su</span> <span class="o">-</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">paramiko</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="n">exit</span>
<span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span>
</pre></div>


<p>As theses plugins are launching commands by <code>ssh</code> we need to login to the distant server of course :)
The good way to manage this is to authentify with a ssh key. One important note here: the shinken daemon run under the <code>shinken</code> user, so it must the the key of this user.</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
</pre></div>


<p>And we must deploy this key on the monitored host too, with the <code>shinken</code> user (by default, you can change it on the hosts configurations):</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="n">ssh</span><span class="o">-</span><span class="n">copy</span><span class="o">-</span><span class="n">id</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span> <span class="n">shinken</span><span class="err">@</span><span class="n">localhost</span>
</pre></div>


<p>Let's give a try at this plugin to see if all is OK:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">check_load_average_by_ssh</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">H</span> <span class="n">localhost</span> <span class="o">-</span><span class="n">i</span> <span class="o">~/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span>
<span class="nl">Ok:</span> <span class="n">load</span> <span class="n">average</span> <span class="n">is</span> <span class="n">good</span> <span class="mf">0.00</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.00</span> <span class="o">|</span>  <span class="n">load1</span><span class="o">=</span><span class="mf">0.00</span><span class="p">;</span><span class="mf">1.00</span><span class="p">;</span><span class="mf">2.00</span><span class="p">;;</span> <span class="n">load5</span><span class="o">=</span><span class="mf">0.00</span><span class="p">;</span><span class="mf">1.00</span><span class="p">;</span><span class="mf">2.00</span><span class="p">;;</span> <span class="n">load15</span><span class="o">=</span><span class="mf">0.00</span><span class="p">;</span><span class="mf">1.00</span><span class="p">;</span><span class="mf">2.00</span><span class="p">;;</span>
</pre></div>


<p>We can now add the linux-ssh tag to the localhost definition:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">hosts</span><span class="o">/</span><span class="n">localhost</span><span class="p">.</span><span class="n">cfg</span>
<span class="n">define</span> <span class="n">host</span><span class="p">{</span>
    <span class="n">use</span>                     <span class="n">linux</span><span class="o">-</span><span class="n">ssh</span><span class="p">,</span><span class="n">generic</span><span class="o">-</span><span class="n">host</span>
    <span class="n">contact_groups</span>          <span class="n">admins</span>
    <span class="n">host_name</span>               <span class="n">localhost</span>
    <span class="n">address</span>                 <span class="n">localhost</span>
    <span class="p">}</span>
</pre></div>


<p>Great :) Now you can restart shinken and tail your shinken logs to wait for some alerts:</p>
<div class="highlight"><pre><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="err">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">shinken</span> <span class="n">restart</span>
<span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">shinken</span><span class="o">/</span><span class="n">schedulerd</span><span class="p">.</span><span class="n">log</span>
</pre></div>


<p>To go further you will maybe need the shinken documentation. You can look at it online on <a href="https://shinken.readthedocs.org/">readthedocs</a> but you can also got it locally on your shinken server (like on an offline network). All you need to do is:</p>
<div class="highlight"><pre><span class="n">shinken</span><span class="err">@</span><span class="n">debian</span><span class="err">$</span> <span class="n">shinken</span> <span class="n">doc</span><span class="o">-</span><span class="n">serve</span>
</pre></div>


<p>will open an http server on the <code>8080</code> port with the documentation :)</p>
<p>The next course will be about installating and configure the default shinken web interface: <code>webui</code>. See you soon for this new course, and let me know in the comments if you like this first course (or not) :)</p>



<p style='border: 2px solid rgba(0,39,59,.2);border-radius: 4px;'><img style='width: 48px;'  data-role="user-avatar" data-user="94550631" src="//a.disquscdn.com/uploads/users/9455/631/avatar92.jpg?1392209481"><a href='#'> jean gabès </a>
<a href='mailto:j.gabes@shinken-solutions.com'><img src="/theme/img/Mail.png" /></a>
<a href='https://twitter.com/naparuba'><img src="/theme/img/Twitter.png" /></a>
<a href='https://github.com/naparuba'><img src="/theme/img/GitHub.png" /></a>
</p>
    <footer>
        <p>Posted in: <a href="/category/talk.html">Talk</a></p>
        <p>Tagged as: <a href="/tag/shinken.html">shinken</a> / <a href="/tag/online-course.html">online course</a> / <a href="/tag/installation.html">installation</a></p>
        <p>Wanna tell me what you think? <a href="/">Get in touch.</a></p>
    </footer>

<hr/>

<div id="disqus_thread"></div>
  <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'shinkenlabio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    


        </footer>
    </article>
</section>                    </div>

                    <footer id="site-footer">
                        <p>
                            <a href="" target="_blank">
                                
                            </a> Shinken framework team /
                            <a href="/">Archives</a>
                            / Powered by
                            <a href="https://github.com/getpelican/pelican" target="_blank">
                                Pelican
                            </a>
                        </p>
                    </footer>
                </div> <!-- header+content+footer span -->

            </div> <!-- row -->
        </div> <!-- /container -->

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="/theme/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
        <script>$('body').popover || document.write('<script src="/theme/js/vendor/bootstrap.min.js"><\/script>')</script>

        <script src="/theme/js/vendor/jquery.colorbox-min.js"></script>

        <script src="/theme/js/main.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-48477803-1'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>